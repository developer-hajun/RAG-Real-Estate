<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë¶€ë™ì‚° ì •ë³´ (Full API Version)</title>

    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css"
    />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.js"></script>

    <style>
      /* =========================================
           DESIGN SYSTEM (Toss Style)
           ========================================= */
      :root {
        --t-blue: #0064ff;
        --t-blue-hover: #0050cc;
        --t-bg: #f2f4f6;
        --t-white: #ffffff;
        --t-text-main: #191f28;
        --t-text-sub: #4e5968;
        --t-text-grey: #8b95a1;
        --t-border: #e5e8eb;
        --t-red: #ff3b30;
        --radius-L: 24px;
        --radius-M: 16px;
        --radius-S: 12px;
        --shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        --ease: cubic-bezier(0.2, 0.8, 0.2, 1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Pretendard", sans-serif;
      }
      body {
        background-color: var(--t-bg);
        color: var(--t-text-main);
        overflow-x: hidden;
      }
      a {
        text-decoration: none;
        color: inherit;
        cursor: pointer;
      }
      ul {
        list-style: none;
      }
      input,
      textarea {
        outline: none;
      }

      /* HEADER */
      header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .header-inner {
        width: 100%;
        max-width: 1000px;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .logo {
        font-size: 18px;
        font-weight: 700;
        color: var(--t-blue);
      }
      nav {
        display: flex;
        gap: 24px;
      }
      nav a {
        font-size: 15px;
        font-weight: 500;
        color: var(--t-text-sub);
        transition: color 0.2s;
      }
      nav a:hover,
      nav a.router-link-active {
        color: var(--t-blue);
      }

      /* LAYOUT */
      .main-container {
        padding-top: 80px;
        padding-bottom: 80px;
        max-width: 720px;
        margin: 0 auto;
        min-height: 100vh;
        padding-left: 20px;
        padding-right: 20px;
      }

      /* CARDS */
      .card {
        background: var(--t-white);
        border-radius: var(--radius-L);
        padding: 24px;
        box-shadow: var(--shadow);
        margin-bottom: 16px;
        position: relative;
        transition: transform 0.2s var(--ease), box-shadow 0.2s;
      }
      .card.hoverable:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        cursor: pointer;
      }
      .card h3 {
        font-size: 18px;
        margin-bottom: 8px;
        font-weight: 600;
      }
      .card p {
        color: var(--t-text-sub);
        font-size: 14px;
        margin-bottom: 4px;
        line-height: 1.5;
      }

      /* BUTTONS & INPUTS */
      .btn {
        background-color: var(--t-blue);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: var(--radius-S);
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
        display: inline-flex;
        justify-content: center;
        align-items: center;
      }
      .btn:hover {
        background-color: var(--t-blue-hover);
      }
      .btn-secondary {
        background-color: #e8f3ff;
        color: var(--t-blue);
      }
      .btn-danger {
        background-color: #ffeaea;
        color: var(--t-red);
      }
      .btn-sm {
        padding: 8px 12px;
        font-size: 13px;
      }

      .input-box {
        width: 100%;
        padding: 14px;
        border: 1px solid var(--t-border);
        border-radius: var(--radius-S);
        background: var(--t-white);
        font-size: 15px;
        transition: border-color 0.2s;
        margin-bottom: 10px;
      }
      .input-box:focus {
        border-color: var(--t-blue);
      }

      /* TABS & HERO */
      .hero-section {
        text-align: center;
        padding: 40px 0 60px;
      }
      .hero-title {
        font-size: 36px;
        font-weight: 800;
        line-height: 1.3;
        margin-bottom: 16px;
        color: var(--t-text-main);
      }
      .search-wrapper {
        background: var(--t-white);
        padding: 24px;
        border-radius: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        max-width: 600px;
        margin: 0 auto;
      }
      .tabs {
        background: var(--t-bg);
        padding: 4px;
        border-radius: 14px;
        display: flex;
        position: relative;
        margin-bottom: 20px;
      }
      .tab-btn {
        flex: 1;
        padding: 10px;
        border: none;
        background: none;
        font-size: 14px;
        font-weight: 600;
        color: var(--t-text-grey);
        cursor: pointer;
        z-index: 2;
      }
      .tab-btn.active {
        color: var(--t-blue);
      }
      .tab-indicator {
        position: absolute;
        top: 4px;
        left: 4px;
        bottom: 4px;
        width: calc(33.33% - 4px);
        background: var(--t-white);
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
        transition: transform 0.3s var(--ease);
        z-index: 1;
      }
      .search-bar {
        display: flex;
        gap: 10px;
      }

      /* UTIL */
      .flex-between {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .flex-gap {
        display: flex;
        gap: 10px;
      }
      .badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        background: #f0f0f0;
        color: #555;
      }
      .badge-blue {
        background: #e8f3ff;
        color: var(--t-blue);
      }

      /* ANIMATION */
      .fade-enter-active,
      .fade-leave-active {
        transition: opacity 0.3s var(--ease);
      }
      .fade-enter-from,
      .fade-leave-to {
        opacity: 0;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <header>
        <div class="header-inner">
          <router-link to="/" class="logo">ë¶€ë™ì‚° AI</router-link>
          <nav>
            <router-link to="/">í™ˆ</router-link>
            <router-link to="/realty">ë§¤ë¬¼</router-link>
            <router-link to="/board">ì»¤ë®¤ë‹ˆí‹°</router-link>
            <router-link to="/mypage" v-if="isLoggedIn">ë§ˆì´</router-link>
            <a @click="logout" v-if="isLoggedIn">ë¡œê·¸ì•„ì›ƒ</a>
            <router-link to="/login" v-else>ë¡œê·¸ì¸</router-link>
          </nav>
        </div>
      </header>

      <div class="main-container">
        <router-view v-slot="{ Component }">
          <transition name="fade" mode="out-in">
            <component :is="Component" />
          </transition>
        </router-view>
      </div>
    </div>

    <script>
      const { createApp, ref, reactive, computed, onMounted } = Vue;
      const { createRouter, createWebHashHistory, useRoute, useRouter } = VueRouter;

      /* =================================================================
           1. MOCK DATABASE (ë°ì´í„°ë² ì´ìŠ¤ ì‹œë®¬ë ˆì´ì…˜)
           ================================================================= */
      const DB = reactive({
        users: [{ id: 1, email: "test@test.com", password: "123", name: "ê¹€í† ìŠ¤", age: 30, birthDate: "1994-01-01" }],
        session: null, // í˜„ì¬ ë¡œê·¸ì¸ ìœ ì €
        realties: [
          {
            id: 1,
            name: "ê°•ë‚¨ì—­ 5ë¶„ í’€ì˜µì…˜",
            address: "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™",
            price: 60,
            type: "ì›”ì„¸",
            location: "ê°•ë‚¨",
            deposit: 1000,
          },
          {
            id: 2,
            name: "í•œê°•ë·° í…Œë¼ìŠ¤ ì•„íŒŒíŠ¸",
            address: "ì„œìš¸ì‹œ ì„œì´ˆêµ¬ ë°˜í¬ë™",
            price: 200000,
            type: "ì „ì„¸",
            location: "ì„œì´ˆ",
            deposit: 200000,
          },
          {
            id: 3,
            name: "ëŒ€í•™ê°€ ì‹ ì¶• ì›ë£¸",
            address: "ì„œìš¸ì‹œ ê´€ì•…êµ¬ ì‹ ë¦¼ë™",
            price: 45,
            type: "ì›”ì„¸",
            location: "ê´€ì•…",
            deposit: 500,
          },
          {
            id: 4,
            name: "íŒêµ í…Œí¬ë…¸ë°¸ë¦¬ ì˜¤í”¼ìŠ¤í…”",
            address: "ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬ ì‚¼í‰ë™",
            price: 120,
            type: "ì›”ì„¸",
            location: "íŒêµ",
            deposit: 3000,
          },
        ],
        reviews: [],
        favorites: [],
        posts: [
          {
            id: 1,
            title: "ì´ ì§€ì—­ ì¹˜ì•ˆ ê´œì°®ë‚˜ìš”?",
            content: "ë°¤ì— ë‹¤ë‹ˆê¸° ì–´ë–¤ê°€ìš”?",
            userId: 1,
            viewCount: 10,
            createdDate: "2024-11-28",
          },
          {
            id: 2,
            title: "ì „ì„¸ ëŒ€ì¶œ ê¸ˆë¦¬ ì§ˆë¬¸",
            content: "ì¤‘ê¸°ì²­ ë˜ë‚˜ìš”?",
            userId: 1,
            viewCount: 5,
            createdDate: "2024-11-27",
          },
        ],
        comments: [],
        searchHistories: [],
        ragHistories: [],
      });

      /* =================================================================
           2. MOCK API CLIENT (API ëª…ì„¸ì„œ êµ¬í˜„)
           ================================================================= */
      const api = {
        // [Auth] ì‚¬ìš©ì ê´€ë ¨
        auth: {
          // POST /api/users/login
          login: async (email, password) => {
            const user = DB.users.find((u) => u.email === email && u.password === password);
            if (user) {
              DB.session = user;
              return { message: "ë¡œê·¸ì¸ ì„±ê³µ" };
            }
            throw new Error("ë¡œê·¸ì¸ ì‹¤íŒ¨: ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ í™•ì¸");
          },
          // POST /api/users/logout
          logout: async () => {
            DB.session = null;
            return { message: "ë¡œê·¸ì•„ì›ƒ ì„±ê³µ" };
          },
          // POST /api/users/register
          register: async (data) => {
            DB.users.push({ id: Date.now(), ...data });
            return { message: "íšŒì›ê°€ì… ì„±ê³µ" };
          },
          // GET /api/users/profile
          getProfile: async () => {
            if (!DB.session) throw new Error("ë¹„ë¡œê·¸ì¸");
            return { ...DB.session };
          },
          // PUT /api/users/profile
          updateProfile: async (data) => {
            if (!DB.session) throw new Error("ë¹„ë¡œê·¸ì¸");
            const idx = DB.users.findIndex((u) => u.id === DB.session.id);
            DB.users[idx] = { ...DB.users[idx], ...data };
            DB.session = DB.users[idx];
            return { message: "ìˆ˜ì • ì„±ê³µ" };
          },
          // GET /api/users/searchHistory
          getHistory: async () => {
            if (!DB.session) return [];
            return DB.searchHistories.filter((h) => h.userId === DB.session.id);
          },
        },

        // [Realty] ë¶€ë™ì‚° ê´€ë ¨
        realty: {
          // GET /api/real-estate (Filter)
          getList: async (params) => {
            let res = DB.realties;
            if (params.keyword)
              res = res.filter((r) => r.name.includes(params.keyword) || r.location.includes(params.keyword));
            return res;
          },
          // GET /api/real-estate/{id}
          getDetail: async (id) => {
            return DB.realties.find((r) => r.id == id);
          },
          // GET /api/real-estate/{id}/reviews
          getReviews: async (id) => {
            return DB.reviews
              .filter((r) => r.realtyId == id)
              .map((r) => {
                const u = DB.users.find((u) => u.id === r.userId);
                return { ...r, userName: u ? u.name : "ìµëª…" };
              });
          },
          // POST /api/real-estate/{id}/rate
          addReview: async (id, data) => {
            // rating, text
            if (!DB.session) throw new Error("ë¡œê·¸ì¸ í•„ìš”");
            DB.reviews.push({ id: Date.now(), realtyId: id, userId: DB.session.id, ...data });
            return { message: "í‰ì  ë“±ë¡ ì„±ê³µ" };
          },
          // POST /api/real-estate/{id}/favorite
          toggleFavorite: async (id) => {
            if (!DB.session) throw new Error("ë¡œê·¸ì¸ í•„ìš”");
            const idx = DB.favorites.findIndex((f) => f.realtyId == id && f.userId == DB.session.id);
            if (idx >= 0) {
              DB.favorites.splice(idx, 1);
              return { message: "ì°œ ì·¨ì†Œ" };
            } else {
              DB.favorites.push({ id: Date.now(), realtyId: id, userId: DB.session.id });
              return { message: "ì°œ ì„±ê³µ" };
            }
          },
          // POST /api/real-estate/compare
          compare: async (realtyIds) => {
            const targets = DB.realties.filter((r) => realtyIds.includes(r.id));
            return { comparisons: targets };
          },
        },

        // [Board] ê²Œì‹œíŒ ê´€ë ¨
        board: {
          // GET /api/board/posts, GET /api/board/posts/filter, GET /api/board/posts/popular
          getPosts: async (filterType, keyword) => {
            let res = [...DB.posts];
            if (filterType === "popular") res.sort((a, b) => b.viewCount - a.viewCount);
            if (keyword) res = res.filter((p) => p.title.includes(keyword));
            return res;
          },
          // GET /api/board/posts/{id}
          getPost: async (id) => {
            const p = DB.posts.find((p) => p.id == id);
            const u = DB.users.find((u) => u.id === p.userId);
            return { ...p, writerName: u ? u.name : "ì•Œìˆ˜ì—†ìŒ" };
          },
          // POST /api/board/posts
          createPost: async (data) => {
            if (!DB.session) throw new Error("ë¡œê·¸ì¸ í•„ìš”");
            DB.posts.unshift({
              id: Date.now(),
              userId: DB.session.id,
              viewCount: 0,
              createdDate: new Date().toLocaleDateString(),
              ...data,
            });
            return { message: "ê²Œì‹œë¬¼ ìƒì„± ì„±ê³µ" };
          },
          // DELETE /api/board/posts/{id}
          deletePost: async (id) => {
            const idx = DB.posts.findIndex((p) => p.id == id);
            if (idx > -1) DB.posts.splice(idx, 1);
            return { message: "ê²Œì‹œë¬¼ ì‚­ì œ ì„±ê³µ" };
          },
          // POST /api/board/posts/{id}/comments
          addComment: async (id, content) => {
            DB.comments.push({ id: Date.now(), postId: id, content, userId: DB.session.id });
            return { message: "ëŒ“ê¸€ ì‘ì„± ì„±ê³µ" };
          },
          // Helper for comments
          getComments: async (postId) => {
            return DB.comments
              .filter((c) => c.postId == postId)
              .map((c) => {
                const u = DB.users.find((user) => user.id === c.userId);
                return { ...c, writerName: u ? u.name : "ìµëª…" };
              });
          },
        },

        // [RAG] AI ê²€ìƒ‰
        rag: {
          // GET /api/rag/find
          find: async (findString) => {
            // ì‹œë®¬ë ˆì´ì…˜: ê²€ìƒ‰ì–´ ì €ì¥
            if (DB.session) {
              DB.searchHistories.push({
                id: Date.now(),
                userId: DB.session.id,
                text: findString,
                createdDate: new Date().toLocaleString(),
              });
            }

            // ë”ë¯¸ ì‘ë‹µ ìƒì„±
            const answer = `"${findString}"ì— ëŒ€í•œ AI ë¶„ì„ ê²°ê³¼ì…ë‹ˆë‹¤.\ní•´ë‹¹ ì§€ì—­ì€ ìµœê·¼ ì‹¤ê±°ë˜ê°€ê°€ ìƒìŠ¹ ì¶”ì„¸ì´ë©°, êµí†µ í˜¸ì¬ê°€ ì˜ˆìƒë©ë‹ˆë‹¤. ì¶”ì²œ ë§¤ë¬¼ì€ 3ê±´ ìˆìŠµë‹ˆë‹¤.`;

            // ê¸°ë¡ ì €ì¥ (findListìš©)
            DB.ragHistories.push({ query: findString, answer, date: new Date().toLocaleTimeString() });

            return { message: "ë¶„ì„ ì™„ë£Œ", answer };
          },
          // GET /api/rag/findList
          findList: async () => {
            return { list: DB.ragHistories };
          },
        },
      };

      /* =================================================================
           3. COMPONENTS (í™”ë©´)
           ================================================================= */

      // [HOME] íƒ­: ë™ë³„/ì•„íŒŒíŠ¸ë³„/AIê²€ìƒ‰
      const Home = {
        setup() {
          const router = useRouter();
          const currentTab = ref(0); // 0:ë™, 1:ì•„íŒŒíŠ¸, 2:AI(RAG)
          const searchText = ref("");
          const ragResult = ref("");

          const placeholders = ["ë™ ì´ë¦„ (ì˜ˆ: ì—­ì‚¼ë™)", "ì•„íŒŒíŠ¸ ì´ë¦„ (ì˜ˆ: ìì´)", "AIì—ê²Œ ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”"];

          const handleSearch = async () => {
            if (!searchText.value) return;

            if (currentTab.value === 2) {
              // RAG ê²€ìƒ‰ ì‹¤í–‰
              ragResult.value = "AIê°€ ë¶„ì„ì¤‘ì…ë‹ˆë‹¤...";
              const res = await api.rag.find(searchText.value);
              ragResult.value = res.answer;
            } else {
              // ì¼ë°˜ ê²€ìƒ‰ -> ë§¤ë¬¼ ë¦¬ìŠ¤íŠ¸ë¡œ ì´ë™
              router.push({ path: "/realty", query: { q: searchText.value } });
            }
          };

          return { currentTab, searchText, placeholders, handleSearch, ragResult };
        },
        template: `
                <div class="hero-section">
                    <h1 class="hero-title">ì‹¤ê±°ë˜ ë°ì´í„° ê¸°ë°˜<br>ë¶€ë™ì‚° AI í”Œë«í¼</h1>
                    
                    <div class="search-wrapper">
                        <div class="tabs">
                            <div class="tab-indicator" :style="{ transform: \`translateX(\${currentTab * 100}%)\` }"></div>
                            <button class="tab-btn" :class="{active: currentTab===0}" @click="currentTab=0; ragResult=''">ë™ë³„</button>
                            <button class="tab-btn" :class="{active: currentTab===1}" @click="currentTab=1; ragResult=''">ì•„íŒŒíŠ¸ë³„</button>
                            <button class="tab-btn" :class="{active: currentTab===2}" @click="currentTab=2">AI ê²€ìƒ‰</button>
                        </div>
                        
                        <div class="search-bar">
                            <input v-model="searchText" type="text" :placeholder="placeholders[currentTab]" @keyup.enter="handleSearch">
                            <button class="btn" @click="handleSearch">ê²€ìƒ‰</button>
                        </div>

                        <div v-if="currentTab === 2 && ragResult" style="margin-top:20px; text-align:left; background:#f9f9f9; padding:15px; border-radius:12px; white-space:pre-wrap;">
                            <strong>ğŸ¤– AI ë‹µë³€:</strong><br>{{ ragResult }}
                        </div>
                    </div>
                </div>
            `,
      };

      // [REALTY LIST & COMPARE]
      const RealtyList = {
        setup() {
          const route = useRoute();
          const router = useRouter();
          const items = ref([]);
          const compareList = ref([]); // ë¹„êµí•¨ ë‹´ê¸´ IDë“¤
          const showCompareModal = ref(false);
          const compareResult = ref([]);

          onMounted(async () => {
            items.value = await api.realty.getList({ keyword: route.query.q });
          });

          const toggleCompare = (id) => {
            if (compareList.value.includes(id)) compareList.value = compareList.value.filter((i) => i !== id);
            else {
              if (compareList.value.length >= 2) alert("ë¹„êµëŠ” ìµœëŒ€ 2ê°œê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
              else compareList.value.push(id);
            }
          };

          const doCompare = async () => {
            if (compareList.value.length < 2) return alert("2ê°œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”");
            const res = await api.realty.compare(compareList.value);
            compareResult.value = res.comparisons;
            showCompareModal.value = true;
          };

          return { items, compareList, toggleCompare, doCompare, showCompareModal, compareResult, router };
        },
        template: `
                <div>
                    <div class="flex-between" style="margin-bottom:20px;">
                        <h2>ğŸ¢ ë§¤ë¬¼ ëª©ë¡</h2>
                        <button v-if="compareList.length > 0" class="btn btn-sm" @click="doCompare">
                            ë¹„êµí•˜ê¸° ({{ compareList.length }})
                        </button>
                    </div>

                    <div v-for="item in items" :key="item.id" class="card hoverable" @click="router.push('/realty/'+item.id)">
                        <div class="flex-between">
                            <h3>{{ item.name }}</h3>
                            <input type="checkbox" @click.stop="toggleCompare(item.id)" :checked="compareList.includes(item.id)">
                        </div>
                        <p>ğŸ“ {{ item.address }}</p>
                        <p style="color:var(--t-blue); font-weight:bold;">{{ item.price }}ë§Œì› / {{ item.type }}</p>
                    </div>

                    <div v-if="showCompareModal" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; display:flex; justify-content:center; align-items:center;">
                        <div class="card" style="width:90%; max-width:500px;">
                            <h3>âš–ï¸ ë§¤ë¬¼ ë¹„êµ ê²°ê³¼</h3>
                            <div style="display:flex; gap:10px; margin-top:20px;">
                                <div v-for="c in compareResult" :key="c.id" style="flex:1; background:#f0f0f0; padding:10px; border-radius:8px;">
                                    <h4>{{ c.name }}</h4>
                                    <p>{{ c.price }}ë§Œì›</p>
                                    <p>{{ c.type }}</p>
                                </div>
                            </div>
                            <button class="btn" style="width:100%; margin-top:20px;" @click="showCompareModal=false">ë‹«ê¸°</button>
                        </div>
                    </div>
                </div>
            `,
      };

      // [REALTY DETAIL]
      const RealtyDetail = {
        setup() {
          const route = useRoute();
          const item = ref({});
          const reviews = ref([]);
          const newReview = reactive({ rating: 5, text: "" });

          const load = async () => {
            const id = route.params.id;
            item.value = await api.realty.getDetail(id);
            reviews.value = await api.realty.getReviews(id);
          };
          onMounted(load);

          const addFav = async () => {
            try {
              const res = await api.realty.toggleFavorite(item.value.id);
              alert(res.message);
            } catch (e) {
              alert(e.message);
            }
          };

          const submitReview = async () => {
            try {
              await api.realty.addReview(item.value.id, newReview);
              alert("ë¦¬ë·° ë“±ë¡ ì™„ë£Œ");
              newReview.text = "";
              load();
            } catch (e) {
              alert(e.message);
            }
          };

          return { item, reviews, newReview, addFav, submitReview };
        },
        template: `
                <div v-if="item.id">
                    <div class="card">
                        <span class="badge badge-blue">{{ item.type }}</span>
                        <h2 style="margin:10px 0;">{{ item.name }}</h2>
                        <p style="font-size:16px;">{{ item.address }}</p>
                        <h1 style="color:var(--t-blue); margin: 20px 0;">{{ item.price }}ë§Œì›</h1>
                        <div class="flex-gap">
                            <button class="btn" style="flex:1" @click="addFav">â¤ï¸ ì°œí•˜ê¸°</button>
                        </div>
                    </div>

                    <div class="card">
                        <h3>â­ ë¦¬ë·° ë° í‰ì </h3>
                        <div style="margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:15px;">
                            <select v-model="newReview.rating" style="padding:5px; margin-right:5px;">
                                <option value="5">5ì </option><option value="4">4ì </option><option value="3">3ì </option>
                            </select>
                            <input v-model="newReview.text" placeholder="ë¦¬ë·° ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" style="width:70%; padding:5px;">
                            <button @click="submitReview" class="btn btn-sm" style="margin-left:5px;">ë“±ë¡</button>
                        </div>
                        <div v-for="r in reviews" :key="r.id" style="margin-bottom:10px;">
                            <strong>{{ r.userName }}</strong> ({{ r.rating }}ì ): {{ r.text }}
                        </div>
                    </div>
                </div>
            `,
      };

      // [BOARD]
      const Board = {
        setup() {
          const posts = ref([]);
          const mode = ref("list"); // list, write
          const form = reactive({ title: "", content: "" });
          const filter = ref("");

          const loadPosts = async () => {
            posts.value = await api.board.getPosts("all", filter.value);
          };
          const loadPopular = async () => {
            posts.value = await api.board.getPosts("popular");
          };

          onMounted(loadPosts);

          const savePost = async () => {
            try {
              await api.board.createPost(form);
              alert("ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
              mode.value = "list";
              loadPosts();
            } catch (e) {
              alert(e.message);
            }
          };

          const deletePost = async (id) => {
            if (confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
              await api.board.deletePost(id);
              loadPosts();
            }
          };

          return { posts, mode, form, filter, loadPosts, loadPopular, savePost, deletePost };
        },
        template: `
                <div>
                    <div v-if="mode==='list'">
                        <div class="flex-between" style="margin-bottom:15px;">
                            <h2>ğŸ“¢ ê²Œì‹œíŒ</h2>
                            <button class="btn btn-sm" @click="mode='write'">ê¸€ì“°ê¸°</button>
                        </div>
                        <div class="flex-gap" style="margin-bottom:15px;">
                            <input v-model="filter" class="input-box" placeholder="ê²€ìƒ‰ì–´" style="margin-bottom:0;">
                            <button class="btn btn-sm btn-secondary" @click="loadPosts">ê²€ìƒ‰</button>
                            <button class="btn btn-sm btn-secondary" @click="loadPopular">ì¸ê¸°ê¸€</button>
                        </div>

                        <div v-for="p in posts" :key="p.id" class="card hoverable" @click="$router.push('/board/'+p.id)">
                            <h3>{{ p.title }}</h3>
                            <p>ì¡°íšŒ {{ p.viewCount }} Â· {{ p.createdDate }}</p>
                            <button class="btn btn-sm btn-danger" style="margin-top:10px;" @click.stop="deletePost(p.id)">ì‚­ì œ</button>
                        </div>
                    </div>

                    <div v-if="mode==='write'">
                        <h2>ìƒˆ ê¸€ ì‘ì„±</h2>
                        <input v-model="form.title" class="input-box" placeholder="ì œëª©">
                        <textarea v-model="form.content" class="input-box" rows="5" placeholder="ë‚´ìš©"></textarea>
                        <div class="flex-gap">
                            <button class="btn" @click="savePost">ë“±ë¡</button>
                            <button class="btn btn-secondary" @click="mode='list'">ì·¨ì†Œ</button>
                        </div>
                    </div>
                </div>
            `,
      };

      // [POST DETAIL]
      const PostDetail = {
        setup() {
          const route = useRoute();
          const post = ref({});
          const comments = ref([]);
          const commentText = ref("");

          const load = async () => {
            post.value = await api.board.getPost(route.params.id);
            comments.value = await api.board.getComments(route.params.id);
          };
          onMounted(load);

          const addComment = async () => {
            await api.board.addComment(post.value.id, commentText.value);
            commentText.value = "";
            load();
          };

          return { post, comments, commentText, addComment };
        },
        template: `
                <div v-if="post.id">
                    <div class="card">
                        <h2>{{ post.title }}</h2>
                        <p>ì‘ì„±ì: {{ post.writerName }}</p>
                        <hr style="margin:15px 0; border:0; border-top:1px solid #eee;">
                        <p style="white-space:pre-wrap;">{{ post.content }}</p>
                    </div>

                    <div class="card">
                        <h3>ëŒ“ê¸€ ({{ comments.length }})</h3>
                        <div class="flex-gap" style="margin-bottom:15px;">
                            <input v-model="commentText" class="input-box" placeholder="ëŒ“ê¸€ ì‘ì„±" style="margin:0;">
                            <button class="btn btn-sm" @click="addComment">ë“±ë¡</button>
                        </div>
                        <div v-for="c in comments" :key="c.id" style="border-bottom:1px solid #eee; padding:10px 0;">
                            <strong>{{ c.writerName }}</strong>: {{ c.content }}
                        </div>
                    </div>
                </div>
            `,
      };

      // [MY PAGE]
      const MyPage = {
        setup() {
          const profile = reactive({});
          const histories = ref([]);
          const editMode = ref(false);

          onMounted(async () => {
            try {
              const data = await api.auth.getProfile();
              Object.assign(profile, data);
              histories.value = await api.auth.getHistory();
            } catch (e) {
              alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            }
          });

          const saveProfile = async () => {
            await api.auth.updateProfile(profile);
            alert("ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
            editMode.value = false;
          };

          return { profile, histories, editMode, saveProfile };
        },
        template: `
                <div>
                    <div class="card">
                        <div class="flex-between">
                            <h2>ğŸ‘¤ ë‚´ í”„ë¡œí•„</h2>
                            <button class="btn btn-sm" @click="editMode = !editMode">{{ editMode ? 'ì·¨ì†Œ' : 'ìˆ˜ì •' }}</button>
                        </div>
                        <div v-if="!editMode">
                            <p><strong>ì´ë¦„:</strong> {{ profile.name }}</p>
                            <p><strong>ì´ë©”ì¼:</strong> {{ profile.email }}</p>
                            <p><strong>ë‚˜ì´:</strong> {{ profile.age }}</p>
                            <p><strong>ìƒë…„ì›”ì¼:</strong> {{ profile.birthDate }}</p>
                        </div>
                        <div v-else style="margin-top:10px;">
                            <input v-model="profile.name" class="input-box" placeholder="ì´ë¦„">
                            <input v-model="profile.age" class="input-box" placeholder="ë‚˜ì´">
                            <input v-model="profile.birthDate" class="input-box" placeholder="ìƒë…„ì›”ì¼">
                            <button class="btn" style="width:100%" @click="saveProfile">ì €ì¥í•˜ê¸°</button>
                        </div>
                    </div>

                    <div class="card">
                        <h3>ğŸ• ìµœê·¼ ê²€ìƒ‰ ê¸°ë¡ ({{ histories.length }})</h3>
                        <ul>
                            <li v-for="h in histories" :key="h.id" style="padding:5px 0; color:#555;">
                                {{ h.text }} <small style="color:#aaa;">({{ h.createdDate }})</small>
                            </li>
                        </ul>
                    </div>
                </div>
            `,
      };

      // [AUTH]
      const Login = {
        setup() {
          const router = useRouter();
          const form = reactive({ email: "", password: "", name: "", age: "", birthDate: "" });
          const isRegister = ref(false);

          const submit = async () => {
            try {
              if (isRegister.value) {
                await api.auth.register(form);
                alert("ê°€ì… ì™„ë£Œ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
                isRegister.value = false;
              } else {
                await api.auth.login(form.email, form.password);
                alert("ë¡œê·¸ì¸ ì„±ê³µ!");
                router.push("/");
              }
            } catch (e) {
              alert(e.message);
            }
          };

          return { form, isRegister, submit };
        },
        template: `
                <div style="max-width:400px; margin:0 auto; padding-top:40px;">
                    <h2 style="text-align:center; margin-bottom:20px;">{{ isRegister ? 'íšŒì›ê°€ì…' : 'ë¡œê·¸ì¸' }}</h2>
                    <input v-model="form.email" class="input-box" placeholder="ì´ë©”ì¼">
                    <input v-model="form.password" type="password" class="input-box" placeholder="ë¹„ë°€ë²ˆí˜¸">
                    
                    <div v-if="isRegister">
                        <input v-model="form.name" class="input-box" placeholder="ì´ë¦„">
                        <input v-model="form.age" class="input-box" placeholder="ë‚˜ì´">
                        <input v-model="form.birthDate" class="input-box" placeholder="ìƒë…„ì›”ì¼ (YYYY-MM-DD)">
                    </div>

                    <button class="btn" style="width:100%; margin-top:10px;" @click="submit">
                        {{ isRegister ? 'ê°€ì…í•˜ê¸°' : 'ë¡œê·¸ì¸' }}
                    </button>
                    <p style="text-align:center; margin-top:20px; color:#888; cursor:pointer;" @click="isRegister = !isRegister">
                        {{ isRegister ? 'ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?' : 'íšŒì›ê°€ì… í•˜ê¸°' }}
                    </p>
                </div>
            `,
      };

      /* =================================================================
           4. APP CONFIG
           ================================================================= */
      const app = createApp({
        setup() {
          const router = useRouter();
          const isLoggedIn = computed(() => !!DB.session);
          const logout = async () => {
            await api.auth.logout();
            alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
            router.push("/login");
          };
          return { isLoggedIn, logout };
        },
      });

      const router = createRouter({
        history: createWebHashHistory(),
        routes: [
          { path: "/", component: Home },
          { path: "/realty", component: RealtyList },
          { path: "/realty/:id", component: RealtyDetail },
          { path: "/board", component: Board },
          { path: "/board/:id", component: PostDetail },
          { path: "/mypage", component: MyPage },
          { path: "/login", component: Login },
        ],
      });

      app.use(router);
      app.mount("#app");
    </script>
  </body>
</html>
